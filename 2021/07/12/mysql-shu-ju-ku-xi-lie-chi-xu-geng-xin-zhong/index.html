<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="Mysql数据库系列——持续更新中, 操作系统 计算机网络 java系列">
    <meta name="baidu-site-verification" content="fmlEuI34ir" />
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48" />
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7" />
    <meta name="description" content="前言有一段时间我很困惑，如何在有限的时间内展开繁杂的内容，最终在评论区找到了答案：

将每一小节的内容提炼成问题，通过回答这些问题来掌握知识，详略分明且高效！

一.一条sql查询语句是如何执行的1.mysql的框架有哪些基本组件，各是什么">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Mysql数据库系列——持续更新中 | 归处的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?ce84511d3df71640a9378a69f6293044";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<meta name="generator" content="Hexo 5.4.0"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">归处的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">归处的博客</div>
        <div class="logo-desc">
            
            山高路远，静水深流
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/godweiyang/hexo-matery-modified" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/godweiyang/hexo-matery-modified" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/28.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Mysql数据库系列——持续更新中
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/" target="_blank">
                            <span class="chip bg-color">极客时间</span>
                        </a>
                        
                        <a href="/tags/Mysql/" target="_blank">
                            <span class="chip bg-color">Mysql</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="post-category" target="_blank">
                            数据库
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-07-12
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    归处
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    6.9k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    24 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>有一段时间我很困惑，如何在有限的时间内展开繁杂的内容，最终在评论区找到了答案：</p>
<blockquote>
<p>将每一小节的内容提炼成问题，通过回答这些问题来掌握知识，详略分明且高效！</p>
</blockquote>
<h2 id="一-一条sql查询语句是如何执行的"><a href="#一-一条sql查询语句是如何执行的" class="headerlink" title="一.一条sql查询语句是如何执行的"></a>一.一条sql查询语句是如何执行的</h2><h3 id="1-mysql的框架有哪些基本组件，各是什么功能？"><a href="#1-mysql的框架有哪些基本组件，各是什么功能？" class="headerlink" title="1.mysql的框架有哪些基本组件，各是什么功能？"></a>1.mysql的框架有哪些基本组件，各是什么功能？</h3><p>所有的故事，都从一张图开始：</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210604153409674.png" alt="image-20210604153409674"></p>
<p>可以看到，mysql大致分为server层与存储引擎层：</p>
<ul>
<li><code>server层：</code>包含连接器，查询缓存，分析器，执行器等，涵盖了mysql的大多数的核心功能，以及所有的内置函数(日期，时间，数学，加密函数）,所有跨存储引擎的功能都在这一层实现，如存储过程，触发器，视图。</li>
<li><code>存储引擎层：</code>它以插件式的架构方式负责数据的存储与提取，支持InnoDB,Memory,MyISAM等存储引擎，默认引擎是<strong>InnoDB</strong>.</li>
<li>关系：<strong>所有存储引擎共用一个server层</strong>。</li>
</ul>
<h3 id="2-server层包含哪些组件？它们各是什么作用？"><a href="#2-server层包含哪些组件？它们各是什么作用？" class="headerlink" title="2.server层包含哪些组件？它们各是什么作用？"></a>2.server层包含哪些组件？它们各是什么作用？</h3><ol>
<li><p><code>连接器</code>：连接器负责和mysql服务器端<strong>建立连接，获取权限，维持和管理连接</strong></p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210604155808563.png" alt="image-20210604155808563"></p>
<p>在连接建立后，如果没有使用，就会进入sleep状态。</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210604160921192.png" alt="image-20210604160921192"></p>
<p>如果客户端太久没动作（<strong>wait_timeout=8小时</strong>），连接器就会将其自动断开。</p>
<p>当然，上面的情况是基于长连接的，而长连接正如我们在计网中了解的一样：<strong>如果客户端持续有请求，则使用同一个连接</strong>。长连接有效减少了频繁建立，销毁连接的成本，但也带来了一些问题：</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> mysql在执行过程中临时使用的内存是管理在连接对象中的，如果连接长期存在，会导致MYsql占用内存过多，最终导致OOM</li>
</ul>
<p>而针对长连接占用内存过多的问题，通常有这样两种解决方式：</p>
<ul>
<li><strong>定期断开连接</strong></li>
<li>MYSQL5.7以后，可以在每次执行比较大的操作后，执行<strong>mysql_reset_connection</strong>来重新初始化连接资源。</li>
</ul>
</li>
<li><p><code>查询缓存</code>：</p>
<p>首先要明确的是：不建议使用功能缓存，原因如下：</p>
<p>我们在拿到一个查询请求后，首先会查询缓存，如果缓存中存在<strong>以键值对形式存在的记录</strong>，则直接从缓存中拿，也无须再执行后续环节，直接返回命中结果即可。如果缓存中不存在，则继续流程。</p>
<p>但如果我们拿到的是一个更新请求呢？那查询缓存不仅没用，还需要清空缓存，也就是我们常说的<strong>缓存失效</strong>，在一个更新语句频繁的系统中，要查询缓存有何用？</p>
<p>让人戏谑的是，在mysql8.0以后，查询缓存彻底成了过去式。</p>
</li>
<li><p><code>分析器</code>：</p>
<ol>
<li>词法分析：我们输入是由多个字符串和空格组成的一条sql语句，mysql需要识别里面的字符串分别是啥，如需要把字符串test识别为表test。</li>
<li>语法分析：简言之，判断sql语句的语法是否正确。</li>
</ol>
</li>
<li><p><code>优化器</code>：</p>
<p>哪些方面有优化空间呢？<strong>join的连接顺序，索引</strong>，所以优化器会决定选择哪一个。</p>
</li>
<li><p><code>执行器</code>：</p>
<p>在执行之前，首先查看是否具有执行权限，如果没有，返回错误。如果命中，则<strong>在查询缓存返回结果的时候做权限验证</strong>。</p>
<p>如果有权限，则执行器调用引擎提供的接口，调用API，完成操作。</p>
</li>
</ol>
<h3 id="3-存储引擎层有什么作用？"><a href="#3-存储引擎层有什么作用？" class="headerlink" title="3.存储引擎层有什么作用？"></a>3.存储引擎层有什么作用？</h3><p>留个坑</p>
<hr>
<blockquote>
<p>日拱一卒，功不唐捐。</p>
</blockquote>
<hr>
<h2 id="二-一条sql更新语句是如何执行的？"><a href="#二-一条sql更新语句是如何执行的？" class="headerlink" title="二.一条sql更新语句是如何执行的？"></a>二.一条sql更新语句是如何执行的？</h2><h3 id="1-redo-log的概念是什么？底层实现机制是怎样的？"><a href="#1-redo-log的概念是什么？底层实现机制是怎样的？" class="headerlink" title="1.redo log的概念是什么？底层实现机制是怎样的？"></a>1.redo log的概念是什么？底层实现机制是怎样的？</h3><p><code>redo-log</code>：即重做日志，它独属于InnoDB引擎，是一种物理日志，记录了在数据页上的操作，可以保证crash safe.</p>
<p><code>原理</code>：假如在执行更新语句后，直接将更新写回磁盘，就会影响即时体验。所以我们需要借鉴这样的思想：</p>
<blockquote>
<p>《孔乙已》中的酒店掌柜不会直接将还账记录写到<strong>账本(磁盘)<strong>中，而会将</strong>还账(更新</strong>,即做了什么)记录在**粉板(redo-log)**上，在空闲时，在全部写入账本中。</p>
</blockquote>
<p><code>底层原理</code>：InnoDB的redo-log是固定大小的，如可以配置为一组4个文件，每个文件大小1GB，记录日志时使用<strong>循环队列</strong>的数据结构，当循环队列已满，会将最久的日志擦除(写入磁盘)，然后使用新的日志填充空间。</p>
<p>redo-log并非直接持久化到磁盘，它会首先存储到<code>redo-log buffer</code>，接着存储到文件系统的<code>page cache</code>,最后才<code>持久化</code>到磁盘。</p>
<h3 id="2-什么是WAL（write-ahead-logging）机制，好处是什么？"><a href="#2-什么是WAL（write-ahead-logging）机制，好处是什么？" class="headerlink" title="2.什么是WAL（write ahead logging）机制，好处是什么？"></a>2.什么是WAL（write ahead logging）机制，好处是什么？</h3><p>直白的说，就是<code>先写日志，再写入磁盘</code>，日志是被加载到内存中的，写入速度快，而写入磁盘是机械运动，写入速度非常慢。</p>
<h3 id="3-redo-log是如何保证crash-safe的？"><a href="#3-redo-log是如何保证crash-safe的？" class="headerlink" title="3.redo log是如何保证crash-safe的？"></a>3.redo log是如何保证crash-safe的？</h3><p>所谓crash，指的<code>是数据库异常重启</code>的场景，显然，如果不使用redo-log机制，此时仅有负责归档(用于备份)的bin-log，数据的更新不会被刷新到磁盘中去。</p>
<p>而redo-log机制负责物理更新刷新到磁盘中去，<code>不会出现物理与逻辑数据不一致</code>的状况。</p>
<h3 id="4-binlog如何理解，它的底层实现机制是怎样的，它可以保证crash-safe吗？"><a href="#4-binlog如何理解，它的底层实现机制是怎样的，它可以保证crash-safe吗？" class="headerlink" title="4.binlog如何理解，它的底层实现机制是怎样的，它可以保证crash-safe吗？"></a>4.binlog如何理解，它的底层实现机制是怎样的，它可以保证crash-safe吗？</h3><p><code>bin-log</code>:即归档日志，由server层实现，记录数据库的逻辑操作，用于全量备份。当需要恢复数据时，可以取出某个时间段内的bin-log进行重放恢复。</p>
<p><code>底层原理</code>：bin-log区别于redo-log，它没有文件大小的限制，会追加写；</p>
<p>每个线程都有自己的binlog cache,但是会共用一份binlog文件。</p>
<p>持久化到磁盘分为两个阶段：首先将日志写到文件系统的<strong>page cache</strong>,此时并没有持久化到磁盘，所以速度比较快；接着<strong>fsync</strong>,即是将数据持久化到磁盘，一般认为只有fsync才占磁盘的<strong>IOPS</strong>。</p>
<p><code>crash-safe</code>:crash要解决的问题是逻辑数据与物理数据不一致的问题，也就是保证将内存中物理数据刷新到内存，但bin-log表示我做不到~</p>
<h3 id="5-对比redo-log和bin-log"><a href="#5-对比redo-log和bin-log" class="headerlink" title="5.对比redo-log和bin-log."></a>5.对比redo-log和bin-log.</h3><table>
<thead>
<tr>
<th></th>
<th>redo-log</th>
<th>bin-log</th>
</tr>
</thead>
<tbody><tr>
<td>文件大小</td>
<td>覆盖写</td>
<td>追加写</td>
</tr>
<tr>
<td>层级</td>
<td>server层</td>
<td>InnoDB引擎</td>
</tr>
<tr>
<td>日志形式</td>
<td>物理日志</td>
<td>逻辑日志</td>
</tr>
<tr>
<td>作用</td>
<td>刷新到磁盘，物理一致性</td>
<td>归档，逻辑一致性</td>
</tr>
<tr>
<td>crash-safe</td>
<td>√</td>
<td>×</td>
</tr>
<tr>
<td>实质</td>
<td>记录数据页做了什么操作</td>
<td>statment模式：记录sql语句    row模式：记录更新前后的行，一般使用row模式</td>
</tr>
</tbody></table>
<h3 id="6-一条sql更新语句是如何执行的？"><a href="#6-一条sql更新语句是如何执行的？" class="headerlink" title="6.一条sql更新语句是如何执行的？"></a>6.一条sql更新语句是如何执行的？</h3><blockquote>
<p>update test set c=c+1 where id = 1</p>
</blockquote>
<ol>
<li>执行器先找引擎找ID=1的这一行，ID为主键，引擎使用B+树的主键索引找到这一行。如果该行在内存中，直接返回给执行器；否则，先从磁盘读取到内存中，再返回；</li>
<li>执行器执行得到新数据，调用引擎接口写入新的行记录；</li>
<li>引擎将这行记录更新到内存中，并将更新的操作记录写到redo-log中，redo-log进行prepare状态；</li>
<li>执行器生成bin-log，将bin-log写入磁盘；</li>
<li>redo-log改为commit状态，更新完成。</li>
</ol>
<h3 id="7-如果数据库误操作，如何将数据恢复？"><a href="#7-如果数据库误操作，如何将数据恢复？" class="headerlink" title="7.如果数据库误操作，如何将数据恢复？"></a>7.如果数据库误操作，如何将数据恢复？</h3><p>找到最近一次的全量备份，<code>从备份时间点开始</code>，将备份的bin-log依次取出，重放到误删时刻。</p>
<h3 id="8-什么是两阶段提交-如果不两阶段提交，会发生什么？"><a href="#8-什么是两阶段提交-如果不两阶段提交，会发生什么？" class="headerlink" title="8.什么是两阶段提交?如果不两阶段提交，会发生什么？"></a>8.什么是两阶段提交?如果不两阶段提交，会发生什么？</h3><p>即确定redo-log与bin-log提交时机，通过<code>两阶段提交来保证跨系统维持数据逻辑一致性</code>。如果没有两阶段提交，就好比读到了事务的脏数据。</p>
<hr>
<blockquote>
<p>日拱一卒，功不唐捐。</p>
</blockquote>
<hr>
<h2 id="三-事务隔离：为什么你改了我还看不见"><a href="#三-事务隔离：为什么你改了我还看不见" class="headerlink" title="三.事务隔离：为什么你改了我还看不见"></a>三.事务隔离：为什么你改了我还看不见</h2><h3 id="1-事务的概念是什么？"><a href="#1-事务的概念是什么？" class="headerlink" title="1.事务的概念是什么？"></a>1.事务的概念是什么？</h3><blockquote>
<p>事务是对数据库中数据操作的<code>保证数据逻辑一致性的最小操作单元</code>。</p>
</blockquote>
<h3 id="2-简述某一场景下，不同事务隔离级别的区别"><a href="#2-简述某一场景下，不同事务隔离级别的区别" class="headerlink" title="2.简述某一场景下，不同事务隔离级别的区别"></a>2.简述某一场景下，不同事务隔离级别的区别</h3><p>有这样的一个场景：</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210606161322663.png" alt="image-20210606161322663"></p>
<p>在该场景下，不同事务隔离级别有不同的返回值：</p>
<ul>
<li><p><code>读未提交</code>：即在事务B没有提交的时候，它做的变更就可以被事务A看到。所以读到的值分别是1,2,2；</p>
</li>
<li><p><code>读已提交</code>：即只有在事务A提交之后，它做的变更才能被事务A看到，所以读到的值为：1,1,2；</p>
</li>
<li><p><code>可重复读</code>：即事务A执行期间读到的值和事务A开启时读到的值是一样的，所以读到的值是1,1,2；</p>
</li>
<li><p><code>串行化</code>：即事务A，事务B对于同一行记录，会通过加读写锁的方式来限制另一个事务。所以读到的值是1,1,2.</p>
</li>
</ul>
<h3 id="3-读已提交，可重复读是怎样通过视图构建实现的？"><a href="#3-读已提交，可重复读是怎样通过视图构建实现的？" class="headerlink" title="3.读已提交，可重复读是怎样通过视图构建实现的？"></a>3.读已提交，可重复读是怎样通过视图构建实现的？</h3><p>首先了解下视图的概念：</p>
<blockquote>
<p>视图是对复杂sql语句的封装，可以认为是拷贝静态数据，对视图做的变更不会同步到数据库中。</p>
</blockquote>
<ul>
<li><p><code>可重复读</code>：在该隔离级别下，数据库在事务启动时创建了一个视图，访问时以视图的逻辑结果为准，在<strong>事务存在期间</strong>都会使用这个视图。他为mysql的默认隔离级别；</p>
</li>
<li><p><code>读未提交</code>：直接返回记录最新值，没有视图概念；</p>
</li>
<li><p><code>读已提交</code>：视图在<strong>sql语句开始执行时</strong>创建。它为oracle的默认隔离级别。</p>
</li>
<li><p><input checked="" disabled="" type="checkbox">  注:配置方式：transaction-isolation=READ-COMMITED</p>
</li>
</ul>
<h3 id="4-简要说明可重复读的使用场景"><a href="#4-简要说明可重复读的使用场景" class="headerlink" title="4.简要说明可重复读的使用场景"></a>4.简要说明可重复读的使用场景</h3><p>在记账的时候很有用。</p>
<h3 id="5-事务隔离是怎样通过read-view实现的"><a href="#5-事务隔离是怎样通过read-view实现的" class="headerlink" title="5.事务隔离是怎样通过read-view实现的?"></a>5.事务隔离是怎样通过read-view实现的?</h3><p>之前我们提到，在事务隔离中，提供了<code>视图这种数据拷贝</code>的方式，而在事务隔离级别下，我们会读到不同的数据，这说明是存在多个视图的，也就是read-view。</p>
<p>在MYSQL中，实际上每条记录在更新时都会记录一条<code>回滚操作</code>，通过回滚操作，可以得到上一个状态的值：</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210606163851669.png" alt="image-20210606163851669"></p>
<p>也就是说，<code>同一个记录在数据库中是存在多个版本的</code>，当我们要读取数据时，要判断这个数据的版本对于当前事务是否可见，如果不可见，就通过<code>undo-log</code>计算得到上一个版本，直到找到正确版本为止。</p>
<p>在不需要的时候，数据库系统会将回滚日志删除。</p>
<h3 id="6-并发版本控制的概念是什么？如何实现？"><a href="#6-并发版本控制的概念是什么？如何实现？" class="headerlink" title="6.并发版本控制的概念是什么？如何实现？"></a>6.并发版本控制的概念是什么？如何实现？</h3><p><code>概念</code>：同一个数据行，在数据库中存在<code>多个版本号</code>，这个版本号可以理解为当前操作这行数据的<code>事务的ID</code>。</p>
<p><code>实现</code>：在进行并发操作时，会使用<code>该行的版本号与当前事务的版本号</code>进行比较，如果刚好等于，也就是说这行数据是由这个事务提交生成的。</p>
<h3 id="7-长事务是什么？使用长事务会拖垮整个库？如何查询各个表中的长事务，那应该如何避免使用长事务？"><a href="#7-长事务是什么？使用长事务会拖垮整个库？如何查询各个表中的长事务，那应该如何避免使用长事务？" class="headerlink" title="7.长事务是什么？使用长事务会拖垮整个库？如何查询各个表中的长事务，那应该如何避免使用长事务？"></a>7.长事务是什么？使用长事务会拖垮整个库？如何查询各个表中的长事务，那应该如何避免使用长事务？</h3><p><code>概念</code>：需要执行很久的事务；</p>
<p><code>底层</code>：长事务意味着系统中有非常多的不能被删除的事务视图，这会导致大量的<code>空间占用</code>，而在mysql5.5之前，即便长事务被提交，<code>回滚段被清理，文件也不会变小</code>，另外长事务还<code>占用锁资源</code>，这时其他就会因锁等待重新建立连接，<code>mysql的连接被占用爆满</code>，导致拖垮整个库。</p>
<p><code>查询</code>：SELECT * FROM information_schema.INNODB_TRX</p>
<p><code>避免</code>：</p>
<ol>
<li>设置autocommmit=1,即自动提交；</li>
<li>写脚本监控information_schema.INNODB_TRX的内容，发现长事务就kill掉它；</li>
<li>设置SQL语句所能执行的最大运行时间；</li>
<li>设置回滚表单独存放，便于回收表空间。</li>
<li>尽量去使用小事务。</li>
</ol>
<h3 id="8-事务的启动方式有哪几种？"><a href="#8-事务的启动方式有哪几种？" class="headerlink" title="8.事务的启动方式有哪几种？"></a>8.事务的启动方式有哪几种？</h3><ul>
<li><code>begin:</code></li>
<li><code>start trasaction:</code>与begin效果一致；</li>
<li><code>start trasaction with consistent snaps hot:</code>该语句执行后，会创建一致性视图，分配事务ID。</li>
</ul>
<h3 id="9-commit-work-and-chain的语法有什么作用？"><a href="#9-commit-work-and-chain的语法有什么作用？" class="headerlink" title="9.commit work and chain的语法有什么作用？"></a>9.commit work and chain的语法有什么作用？</h3><p>提交当前事务+开启下一个事务=begin+commit;</p>
<hr>
<blockquote>
<p>日拱一卒，功不唐捐。</p>
</blockquote>
<hr>
<h2 id="四-深入浅出索引上"><a href="#四-深入浅出索引上" class="headerlink" title="四.深入浅出索引上"></a>四.深入浅出索引上</h2><h3 id="1-索引的概念是什么？"><a href="#1-索引的概念是什么？" class="headerlink" title="1.索引的概念是什么？"></a>1.索引的概念是什么？</h3><p><strong>概念</strong>：索引是一个相对抽象的数据结构，在书中，我们通常抽取<code>目录名与对应的页码号作为目录以快速定位数据</code>，在数据库系统中，索引就是以这样的作用存在的，它是数据库管理系统中一个<code>排序</code>的数据结构)，以<code>协助快速查询</code>、更新数据库表中数据。</p>
<p><strong>类比</strong>：操作系统中使用<strong>inode</strong>来唯一标识文件，在inode中，记录了各个<code>文件分别包含哪些磁盘块</code>，给定inode,就可以找到文件的所有块，在inode中，同样存储了文件属性的磁盘地址。</p>
<h3 id="2-简述索引模型之哈希表"><a href="#2-简述索引模型之哈希表" class="headerlink" title="2.简述索引模型之哈希表"></a>2.简述索引模型之哈希表</h3><p><strong>概述</strong>：哈希表是一种以<code>键值对</code>存储数据的结构，我们只需要输入待查找的key，就可以找到对应的value,哈希表的思路很简单，把值放在数组中，用一个<code>哈希函数把key换算成一个确定的位置</code>，然后将value放在数组的这个位置。</p>
<p><strong>哈希冲突</strong>：使用链表法解决；</p>
<p><strong>示例</strong>：<img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210607202153949.png" alt="image-20210607202153949"></p>
<p><strong>特点</strong>：只适用于<code>等值查询</code>，可以应用于NoSQL不能做<code>区间查询</code>。</p>
<h3 id="3-简述索引模型之有序数组"><a href="#3-简述索引模型之有序数组" class="headerlink" title="3.简述索引模型之有序数组"></a>3.简述索引模型之有序数组</h3><p><strong>概述</strong>：将元素按照一定的顺序排列，这里的顺序<code>不一定是严格自增</code>，而是按照某一属性从小到大排序。假如有一个按照身份证号排列的有序数组，我们要查询某一个身份证号的名字，通过<code>二分法</code>就可以找到。</p>
<p><strong>示例</strong>：<img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210607202732018.png" alt="image-20210607202732018"></p>
<p><strong>特点</strong>：对于<code>等值查找</code>和<code>范围查找</code>都较友好，查询的时间复杂度为<code>O(logN)</code>,但实际上有序数组并没有得到大量应用，这是因为在插入元素时需要大量的<code>数据搬移</code>，也因此有序数组被大量应用于<code>静态存储引擎</code>。</p>
<h3 id="4-简述索引模型之B-树"><a href="#4-简述索引模型之B-树" class="headerlink" title="4.简述索引模型之B+树"></a>4.简述索引模型之B+树</h3><p><strong>概述</strong>：B+树是一种二叉搜索树，它的节点遵循严格的大小关系，<code>二叉搜索树的查询，更新的时间复杂度为O(logN)</code>,</p>
<p><strong>示例</strong>：<img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210607203522696.png" alt="image-20210607203522696"></p>
<p><strong>特点</strong>：<code>B+树</code>即为InnoDB的引擎模型，但考虑到性能，更多被使用的实则是<code>多叉树</code>。</p>
<h3 id="5-为什么N叉树被广泛应用到数据库引擎中？"><a href="#5-为什么N叉树被广泛应用到数据库引擎中？" class="headerlink" title="5.为什么N叉树被广泛应用到数据库引擎中？"></a>5.为什么N叉树被广泛应用到数据库引擎中？</h3><p>我们先设想二叉树存储的场景：假如二叉树<code>树高20</code>，存储了100万行数据，<code>需要读取20个数据块(连续的存储空间)</code>，在机械硬盘时代，读取硬盘是龟速，而这样的龟速，居然要连续查询20次，那怎么提高查询的性能呢？</p>
<p>减少树高，增加一个数据块中的数据，即<code>使用N叉树</code>。</p>
<h3 id="6-基于主键索引和普通索引的查询有什么区别？"><a href="#6-基于主键索引和普通索引的查询有什么区别？" class="headerlink" title="6.基于主键索引和普通索引的查询有什么区别？"></a>6.基于主键索引和普通索引的查询有什么区别？</h3><p><strong>前提</strong>：在InnoDB中，<code>表是根据主键顺序以索引的形式存放</code>，这种存储方式被称为索引组织表。又因为索引是B+树的数据结构，即数据存储在B+树中，而<code>每一个索引在InnoDB里面对应一张表</code>。再进一步，则可以认为表是以多个B+树的形式存储的。</p>
<p><strong>主键索引</strong>：主键索引的叶子结点存储的是<code>整行数据</code>，也因此得名聚簇索引。</p>
<p><strong>普通索引</strong>：非主键索引的叶子结点存储的是<code>主键的值</code>，因此得名二级索引。</p>
<p><strong>区别</strong>：如果where条件需要走主键索引，则只需要搜索主键的B+树，如果where条件走的是普通索引，则就需要先查询普通索引的B+树，得到主键，再去查询普通索引，即<code>回表</code></p>
<h3 id="7-简述维护B-树索引时的页分裂与页合并？"><a href="#7-简述维护B-树索引时的页分裂与页合并？" class="headerlink" title="7.简述维护B+树索引时的页分裂与页合并？"></a>7.简述维护B+树索引时的页分裂与页合并？</h3><ul>
<li><strong>页分裂</strong>：在插入数据时，如果当前数据页已满，就会申请一个新的数据页，导致<code>空间利用率下降</code>；</li>
<li><strong>页合并</strong>：如果因为删除数据，导致<code>利用率变低</code>，则页合并就成了可选的优化方式。</li>
</ul>
<h3 id="8-哪些场景下应该使用自增主键，而哪些场景不应该"><a href="#8-哪些场景下应该使用自增主键，而哪些场景不应该" class="headerlink" title="8.哪些场景下应该使用自增主键，而哪些场景不应该"></a>8.哪些场景下应该使用自增主键，而哪些场景不应该</h3><p><code>自增主键适合递增插入</code>的场景，这样追加数据时，就不需要数据搬移咯。所以<strong>大多数的场景下，我们都会使用自增主键</strong>。</p>
<p>而在有业务逻辑的字段做主键时，数据成本就会变高啦。</p>
<p>如果在<code>典型的KV场景下，就需要使用普通索引</code>。</p>
<h3 id="9-删除主键索引与普通索引有什么影响？"><a href="#9-删除主键索引与普通索引有什么影响？" class="headerlink" title="9.删除主键索引与普通索引有什么影响？"></a>9.删除主键索引与普通索引有什么影响？</h3><p>删除，重建主键索引后，需要同时<code>修改普通索引对应的主键索引</code>，而删除，重建普通索引则让人省心不少。</p>
<h3 id="10-索引的优化"><a href="#10-索引的优化" class="headerlink" title="10.索引的优化"></a>10.索引的优化</h3><ol>
<li><strong>覆盖索引：</strong>如果查询条件使用的是普通索引，或者联合索引的最左原则字段，查询结果是联合索引的字段或者主键，<code>不用回表操作，直接返回结果</code>，减少磁盘读写的次数，提高IO性能。</li>
<li><strong>最左前缀：</strong>联合索引的<code>最左N个字段</code>，也可以是字符串索引的前M个字符；</li>
<li><strong>联合索引：</strong>根据创建<code>联合索引</code>的顺序，<code>以最左原则进行where检索</code>，比如(age,name)以age=1或者age=1 and name=’张三’可以使用索引，单以name=”张三”不会使用索引。考虑到存储空间的问题，还需要根据业务需求，将查找频繁的数据进行靠左创建索引。</li>
<li><strong>索引下推：</strong>like “hello%” and age&gt;10检索，在mysql5.6之前，会对匹配的数据进行会回表查询，5.6版本以后，<code>会先过滤不合法的数据，再对合法的数据进行回表</code>，从而降低回表率，提升检索率。</li>
</ol>
<hr>
<blockquote>
<p>日拱一卒，功不唐捐。</p>
</blockquote>
<hr>
<h2 id="五-全局锁和表锁：给表加个字段怎么有那么多阻碍"><a href="#五-全局锁和表锁：给表加个字段怎么有那么多阻碍" class="headerlink" title="五.全局锁和表锁：给表加个字段怎么有那么多阻碍"></a>五.全局锁和表锁：给表加个字段怎么有那么多阻碍</h2><h3 id="1-简述全局锁锁"><a href="#1-简述全局锁锁" class="headerlink" title="1.简述全局锁锁"></a>1.简述全局锁锁</h3><p><strong>概述</strong>：对整个数据库实例加锁。<br><strong>加锁方式</strong>：<code>Flush tables with read lock(FTWRL)</code>，这个命令可以使整个库处于只读状态。使用该命令之后，数据更新语句、数据定义语句和更新类事务的提交语句等操作都会<code>被阻塞</code>。<br><strong>使用场景</strong>：全库逻辑备份。<br><strong>风险</strong>：<br>    1.如果在<code>主库备份</code>，在备份期间不能更新，<code>业务停摆</code><br>    2.如果在<code>从库备份</code>，备份期间不能执行主库同步的binlog，导致<code>主从延迟</code></p>
<h3 id="2-InnoDB是如何实现全局备份的"><a href="#2-InnoDB是如何实现全局备份的" class="headerlink" title="2.InnoDB是如何实现全局备份的"></a>2.InnoDB是如何实现全局备份的</h3><p><strong>mysqldump</strong>：官方自带的逻辑备份工具mysqldump，当mysqldump使用参数<code>--single-transaction</code>的时候，会启动一个事务，确保拿到<code>一致性视图</code>。而由于<code>MVCC</code>的支持，这个过程中数据是可以正常更新的。</p>
<p>一致性读是好，但是前提是引擎要支持这个隔离级别。</p>
<h2 id="3-如果要全库只读，为什么不使用set-global-readonly-true的方式？"><a href="#3-如果要全库只读，为什么不使用set-global-readonly-true的方式？" class="headerlink" title="3.如果要全库只读，为什么不使用set global readonly=true的方式？"></a>3.如果要全库只读，为什么不使用set global readonly=true的方式？</h2><p>1.在有些系统中，<code>readonly的值会被用来做其他逻辑</code>，比如判断主备库。所以修改global变量的方式影响太大。<br>2.在异常处理机制上有差异。如果执行FTWRL命令之后由于客户端发生异常断开，那么MySQL会自动释放这个全局锁，整个库回到可以正常更新的状态。而将整个库设置为readonly之后，如果客户端发生异常，则数据库就会一直保持readonly状态，这样会<code>导致整个库长时间处于不可写状态，风险较高</code>。</p>
<h2 id="4-表锁简述"><a href="#4-表锁简述" class="headerlink" title="4.表锁简述"></a>4.表锁简述</h2><p><strong>概述</strong>：mysql里面表锁有两种：表锁和MDL(元数据锁)，表锁不建议加，MDL会默认加上；</p>
<p><strong>表锁</strong>：<img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210608082421097.png" alt="    "></p>
<p><strong>MDL</strong>：不需要显式使用，在访问的时候会自动加上，MDL包含<code>读锁和写锁</code>，<code>读锁之间不互斥</code>，可多线程共享，<code>写锁互斥</code>，来保证表结构变更时的安全性。</p>
<p><strong>风险</strong>：MDL直到事务提交才会被释放，因此为了防止MDL存在时间过长，从而MYSQL异常重启，应该避免长事务。</p>
<h3 id="5-如何安全地小表加一个字段"><a href="#5-如何安全地小表加一个字段" class="headerlink" title="5.如何安全地小表加一个字段"></a>5.如何安全地小表加一个字段</h3><ol>
<li>查询长事务，暂停或kill掉长事务；</li>
<li>在alter table语句中指定等待时间，避免阻塞。</li>
</ol>
<hr>
<blockquote>
<p>日拱一卒，功不唐捐。</p>
</blockquote>
<hr>
<h2 id="六-行锁功过：怎么减少行锁对性能的影响"><a href="#六-行锁功过：怎么减少行锁对性能的影响" class="headerlink" title="六.行锁功过：怎么减少行锁对性能的影响"></a>六.行锁功过：怎么减少行锁对性能的影响</h2><h3 id="1-行锁的概述"><a href="#1-行锁的概述" class="headerlink" title="1.行锁的概述"></a>1.行锁的概述</h3><p>行锁即是对数据库的<code>行记录加锁</code>，在引擎层实现，仅<code>InnoDB</code>支持行锁。</p>
<h3 id="2-简述两阶段锁协议"><a href="#2-简述两阶段锁协议" class="headerlink" title="2.简述两阶段锁协议"></a>2.简述两阶段锁协议</h3><p><strong>概念</strong>：在InnoDB事务中，行锁是在需要的时候加上的，但需要等待<code>事务提交才会释放</code>；</p>
<p><strong>建议</strong>：<code>如果你的事务中需要锁多个行，要把最可能造成锁冲突，最可能影响并发度的锁往后放</code>。</p>
<h3 id="3-简述死锁"><a href="#3-简述死锁" class="headerlink" title="3.简述死锁"></a>3.简述死锁</h3><p><strong>概念</strong>：当两个线程都在等待对方锁持有的资源时，就会产生死锁；</p>
<p><strong>预防死锁</strong>：</p>
<ol>
<li><p>设置<code>超时参数</code>，默认为50s，这样显然交互不好，但如果设置过小，又会错将正常等待的线程当做死锁处理，因此<strong>不建议使用这种方案</strong>；</p>
</li>
<li><p><code>死锁检测</code>，发现死锁，马上<code>回滚</code>。这里可以<code>类比spring中的循环依赖</code>，都是需要查看自己所依赖的线程有没有被别人锁住。但这种方案仍有隐患，假设有100个线程并发修改，<code>都去查看自己依赖的线程有没有锁住，就必然需要大量的CPU资源</code>，这也是为什么即便很小的并发量，CPU占用率也可能很高的原因。</p>
<blockquote>
<p>怎样解决由这种热点行更新导致的性能问题？</p>
</blockquote>
<ul>
<li>在<code>确认不会发生死锁的情况下，可关闭死锁检测</code>，但问题在于关掉死锁检测可能导致大量的超时，这是业务有损的；</li>
<li>控制并发度，具体地说，是在数据库服务端实现该逻辑，实现方式自然是<code>特定大小的等待队列</code>；</li>
<li>从设计上看，可以考虑将一行改成逻辑上的多行。</li>
</ul>
</li>
</ol>
<hr>
<blockquote>
<p>日拱一卒，功不唐捐。</p>
</blockquote>
<h2 id="番外"><a href="#番外" class="headerlink" title="番外"></a>番外</h2><h3 id="1-mysql的服务器配置文件"><a href="#1-mysql的服务器配置文件" class="headerlink" title="1.mysql的服务器配置文件"></a>1.mysql的服务器配置文件</h3><p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210607105513978.png" alt="image-20210607105513978"></p>
<h3 id="2-my-cnf-my-ini配置文件详解"><a href="#2-my-cnf-my-ini配置文件详解" class="headerlink" title="2.my.cnf/my.ini配置文件详解"></a>2.my.cnf/my.ini配置文件详解</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/kuoAT/p/7080770.html">https://www.cnblogs.com/kuoAT/p/7080770.html</a></p>
<h3 id="3-mysql日志系统详解"><a href="#3-mysql日志系统详解" class="headerlink" title="3.mysql日志系统详解"></a>3.mysql日志系统详解</h3><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000023827696">https://segmentfault.com/a/1190000023827696</a></p>
<h3 id="4-查看mysql下的几个日志"><a href="#4-查看mysql下的几个日志" class="headerlink" title="4.查看mysql下的几个日志"></a>4.查看mysql下的几个日志</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xuheng8600/article/details/79823875">https://blog.csdn.net/xuheng8600/article/details/79823875</a></p>
<ol>
<li><p><strong>慢查询日志</strong>是记录了执行时间超过参数long_query_time(单位是秒)所设定值的SQL语句日志。</p>
<p>Note:慢查询日志对于我们发现性能有问题的SQL有很帮助，建议使用并经常分析；</p>
</li>
<li><p><strong>查询日志</strong>记录了clinet的所有的语句。</p>
<p>Note:由于log日志记录了数据库所有操作，对于访问频繁的系统，此种日志会造成性能影响，建议关闭。</p>
</li>
<li><p><strong>错误日志</strong>在Mysql数据库中很重要，它记录着mysqld启动和停止，以及服务器在运行过程中发生的任何错误的相关信息。</p>
</li>
<li><p><strong>二进制日志</strong>也通常被称为binlog,它记当着所有的DDL和DML，但不包括数据查询语句。</p>
</li>
</ol>
<h2 id="面经集锦"><a href="#面经集锦" class="headerlink" title="面经集锦"></a>面经集锦</h2><ol>
<li><p>Explain的主要字段</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210613161115048.png" alt="image-20210613161115048"></p>
</li>
<li><p>b+树相比B树的优点</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210613170513272.png" alt="image-20210613170513272"></p>
</li>
<li><p>可不可以切换索引为哈希索引？</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210613162722458.png" alt="image-20210613162722458"></p>
</li>
<li><p>场景题：高并发场景下数据库压力很大，怎么解决？</p>
<p><code>使用索引，使用缓存，分库分表，消息队列</code></p>
</li>
<li><p>mysql分页查询优化</p>
<p><strong>一般查询会从第一条记录开始找起</strong></p>
<ol>
<li><strong>子查询</strong>：这种方式<code>先定位偏移位置的 id</code>，然后往后查询，这种方式适用于 id 递增的情况</li>
<li><strong>id限定</strong>：可以使用 <code>id between and</code> 来查询</li>
</ol>
<p>一般情况下，在数据库中建立表的时候，强制为每一张表添加 id 递增字段，这样方便查询。</p>
</li>
<li><p>mysql 联合索引使用 A&gt;n and B=m 和 A=n and B=m 的区别</p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210613165722760.png" alt="image-20210613165722760"></p>
<p><img src="C:/Users/zyz/AppData/Roaming/Typora/typora-user-images/image-20210613165652454.png" alt="image-20210613165652454"></p>
</li>
<li><p>MySQL的InnoDB和MyISAM区别</p>
<table>
<thead>
<tr>
<th>角度</th>
<th>InnoDB</th>
<th>MyISAM</th>
</tr>
</thead>
<tbody><tr>
<td>事务</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>外键</td>
<td>支持</td>
<td>不支持</td>
</tr>
<tr>
<td>索引</td>
<td>聚集索引</td>
<td>非聚集索引</td>
</tr>
<tr>
<td>表的具体行数</td>
<td>不保存</td>
<td>保存</td>
</tr>
<tr>
<td>锁的粒度</td>
<td>行锁</td>
<td>表锁</td>
</tr>
</tbody></table>
</li>
<li><p>索引如何优化</p>
<p>发现索引走的不好：<strong>慢查询</strong></p>
<ol>
<li>利用<code>覆盖索引</code>来进行查询操作，避免回表；</li>
<li><code>explain中的字段type</code>：至少要达到range级别，要求是ref级别，如果为<strong>consts</strong>最好不过。</li>
<li><code>联合索引最左前缀原则</code>。</li>
<li>union，in,or都能够命中索引，建议使用<code>in</code>.</li>
</ol>
</li>
<li><p>简述乐观锁与悲观锁</p>
<p><strong>乐观锁</strong>：拿数据时不会上锁，但在提交的时候会判断数据有没有被更新，通常使用版本号/时间戳来实现。</p>
<p><strong>悲观锁</strong>：一开始就对商品加上锁（SELECT … <code>FOR UPDATE</code>）</p>
</li>
<li><p>索引一定会命中吗？如何保证命中</p>
<p>不一定会命中，使用explain中的ref字段判断，force index,强制走某个索引</p>
<pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM test01 FORCE INDEX(uk_index) WHERE NAME &#x3D; &#39;测试1&#39; AND age&#x3D;1 ;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
<li><p>mysql数据库为什么要使用N叉树</p>
<p>一个页就是一棵树B+树的节点，数据库I/O操作的最小单位是页，与数据库相关的内容都会存储在页的结构里。</p>
<p>在一棵B+树中，每个节点都是一个页，每次新建节点的时候，就会申请一个页空间</p>
<p>同一层的节点之间，通过页的结构构成了一个双向链表</p>
<p>非叶子节点包括了多个索引行，每个索引行里存储索引键和指向下一层页面的指针</p>
<p>叶子节点为，存储了关键字和行记录，在节点内部(也就是页结构的内部)记录之间是一个单向的链表</p>
<p><img src="https://img-blog.csdnimg.cn/20200404223041152.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0xKRlBIUA==,size_16,color_FFFFFF,t_70#pic_center" alt="img"></p>
</li>
<li><p>说一下你的项目里具体的一个表，有没有建索引，如何建的？</p>
<p>shop表，主键shopId（主键本身就是一种特殊的索引）,外键userId,shopCategoryId</p>
<p><strong>shopId bigint not null auto_invreament primary key</strong></p>
<p>在使用InnoDB存储引擎时，如果没有特别的需要，请永远使用一个与业务无关的自增字段作为主键，除非高并发写入操作可能需要衡量自增主键</p>
</li>
<li><p>innodb 索引文件的存储形式</p>
<p>思路：一个表——》多个B+树——》叶子节点(页结构，即多个磁盘块)+非叶子结点(页结构，即多个磁盘块)——》行数据+索引数据</p>
</li>
<li><p>mysql主键是怎么自增的（其实是说底层的Auto-INC锁）</p>
<p><strong>自增长计数器</strong>,<strong>Auto-INC锁</strong>,表锁</p>
</li>
</ol>
<hr>
<blockquote>
<p>山高路远，静水深流</p>
</blockquote>

            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《Mysql数据库系列——持续更新中》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2021/07/12/mysql-shu-ju-ku-xi-lie-chi-xu-geng-xin-zhong/" property="cc:attributionName"
               rel="cc:attributionURL">
                归处
            </a> 采用
            <a rel="license noopener" target="_blank" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    
    <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '查教程获取',
        clientSecret: '查教程获取',
        repo: 'godweiyang.github.io',
        owner: 'godweiyang',
        admin: "godweiyang",
        id: '2021/07/12/mysql-shu-ju-ku-xi-lie-chi-xu-geng-xin-zhong/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '查教程获取',
        appKey: '查教程获取',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/07/12/jvm-xi-lie-zhi-shi-dian-zong-jie/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/27.jpg" class="responsive-img" alt="JVM系列知识点总结">
                        
                        <span class="card-title">JVM系列知识点总结</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
基于诸葛老师公开课

笔记大致长这个样子——


也可直接访问我的ProcessOn链接：
JVM知识全景图


山高路远，静水深流


                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2021-07-12
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%90%8E%E7%AB%AF/" class="post-category" target="_blank">
                                    后端
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/JVM/" target="_blank">
                        <span class="chip bg-color">JVM</span>
                    </a>
                    
                    <a href="/tags/Java/" target="_blank">
                        <span class="chip bg-color">Java</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/07/12/spring-ioc-yuan-ma-qian-xi/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="Spring IOC源码浅析">
                        
                        <span class="card-title">Spring IOC源码浅析</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            一点思考在开始分析spring IOC的源码之前，我们有必要先理清大致的脉络，而有三个问题对脉络的构建至关重要——

从哪里出发：hello world~ 要想通这一点，我们需要把视角拉回java web，不可置否的是javaweb通过se
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-07-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%90%8E%E7%AB%AF/" class="post-category" target="_blank">
                                    后端
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/spring/" target="_blank">
                        <span class="chip bg-color">spring</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 归处的博客<br />'
            + '作者: 归处<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2017-2020 WeiYang. 版权所有

            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">96.4k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
            <span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-heart-o"></i>
                本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>
                人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            </span>
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/godweiyang" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:godweiyang@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="https://zhihu.com/people/godweiyang" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>



    <a href="http://wpa.qq.com/msgrd?v=3&uin=792321264&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="https://weibo.com/godweiyang" class="tooltipped" target="_blank" data-tooltip="关注我的微博" data-position="top" data-delay="50">
        <i class="fa fa-weibo"></i>
    </a>


</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 80000;
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2017, 09, 11, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=查教程获取"></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '查教程获取');
</script>



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

</body>

</html>